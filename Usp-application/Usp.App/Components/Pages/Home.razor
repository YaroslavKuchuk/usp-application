@page "/"
@rendermode InteractiveServer
@using Usp.App.Logic.Services.Abstractions
@using Usp.Models
@using Usp.App.Components.Pages.Controls
@inject ISellingPointService SellingPointService;

<div class="row">
    <div class="column-single">
        @if (_sellingPoints != null)
        {
            @foreach (var sellingPoint in _sellingPoints.Where(s => s.IsPrimary == true))
            {
                <Tariff Model="sellingPoint" OnTariffSelected="Selected"></Tariff>
            }
        }
    </div>
    <div class="column-right">
        <Results Models="_selectedPoints" />
    </div>
</div>

<div class="row">
    <div class="column-left">
        @if (_sellingPoints != null)
        {
            @foreach (var sellingPoint in _sellingPoints)
            {
                <Tariff Model="sellingPoint" OnTariffSelected="Selected"></Tariff>
            }
        }
    </div>
    <div class="column-right">
        <Results Models="_selectedPoints" />
    </div>
</div>

@code
{
    private List<SellingPointViewModel> _sellingPoints;
    private List<SellingPointViewModel> _selectedPoints = new List<SellingPointViewModel>();

    protected override async Task OnInitializedAsync()
    {
        _sellingPoints = await SellingPointService.GetSellingPoints();
    }

    private void Selected(SellingPointViewModel model)
    {
        var modelInList = _selectedPoints.FirstOrDefault(m => m.Id == model.Id);

        if (modelInList != null)
        {
            _selectedPoints.Remove(modelInList);
        }
        else if (modelInList is null)
        {
            _selectedPoints.Add(model);
        }
    }
}
